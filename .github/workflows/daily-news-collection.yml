name: Daily News Collection

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 7ì‹œ 50ë¶„ (UTC 22:50, í•œêµ­ ì‹œê°„ 7:50)
    - cron: '50 22 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  collect-news:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Collect news from Vercel API
      id: collect_news
      run: |
        echo "Starting daily news collection..."
        response=$(curl -s -X POST https://lumina-next-picker.vercel.app/api/refresh)
        echo "News collection completed!"
        echo "response=$response" >> $GITHUB_OUTPUT
        
    - name: Parse news results
      id: parse_results
      run: |
        response='${{ steps.collect_news.outputs.response }}'
        echo "Raw response: $response"
        
        # JSONì—ì„œ ê²°ê³¼ ì¶”ì¶œ
        if echo "$response" | grep -q '"result"'; then
          us_count=$(echo "$response" | grep -o '"US":[0-9]*' | grep -o '[0-9]*')
          kr_count=$(echo "$response" | grep -o '"KR":[0-9]*' | grep -o '[0-9]*')
          total=$((us_count + kr_count))
          
          echo "us_count=$us_count" >> $GITHUB_OUTPUT
          echo "kr_count=$kr_count" >> $GITHUB_OUTPUT
          echo "total=$total" >> $GITHUB_OUTPUT
        else
          echo "us_count=0" >> $GITHUB_OUTPUT
          echo "kr_count=0" >> $GITHUB_OUTPUT
          echo "total=0" >> $GITHUB_OUTPUT
        fi
        
    - name: Notify completion
      run: |
        echo "âœ… Daily news collection completed at $(date)"
        echo "ðŸ“° Check the latest news at: https://lumina-next-picker.vercel.app/news"
